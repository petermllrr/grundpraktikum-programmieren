package io.petermueller.petrinetz.models.rgraph;

import java.util.ArrayList;
import java.util.Collections;
import java.util.Comparator;
import java.util.List;

import io.petermueller.petrinetz.models.petrinet.Place;

public class Marking {
	public String id;
	public Boolean isActive;
	public Boolean isRoot;
	public List<Place> places;
	public Boolean isPathStart;
	public Boolean isPathEnd;
	
	public Marking(String id, Boolean isActive, List<Place> inputPlaces) {
		this.isActive = isActive;
		this.isRoot = false;
		this.id = id;
		this.places = new ArrayList<Place>(inputPlaces.size());
		this.isPathStart = false;
		this.isPathEnd = false;
		updatePlaces(inputPlaces);
	}
	
	public Marking(List<Place> inputPlaces) {
		this.id = generateMarkingId(inputPlaces);
		this.places = new ArrayList<Place>(inputPlaces.size());
		updatePlaces(inputPlaces);
	}
	
	public void updatePlaces(List<Place> inputPlaces) {
		for (Place inputPlace : inputPlaces) {
			Place copy = new Place(inputPlace.id);
			copy.currentTokens = inputPlace.currentTokens;
			this.places.add(copy);
		}
	}
	
	private String generateMarkingId(List<Place> places) {
		sortPlaces(places);
		String id = "(";
		for (Place place : places) {
			id = id + place.currentTokens + "|";
		}
		id = id.substring(0, id.length() - 1);
		id = id + ")";
		return id;
	};
	
	private void sortPlaces(List<Place> places) {
		Collections.sort(places, new Comparator<Place>() {
			@Override
			public int compare(Place o1, Place o2) {
				return o1.id.compareTo(o2.id);
			}
		});
	}
}