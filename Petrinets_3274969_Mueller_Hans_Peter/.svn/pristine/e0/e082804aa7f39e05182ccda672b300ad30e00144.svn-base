package io.petermueller.petrinetz.controllers;

import io.petermueller.petrinetz.models.filesystem.FileSystemModel;
import io.petermueller.petrinetz.models.petrinet.PetriNetModel;
import io.petermueller.petrinetz.models.rgraph.RGraphModel;
import io.petermueller.petrinetz.util.Event;
import io.petermueller.petrinetz.util.EventListener;
import io.petermueller.petrinetz.views.RGraphView;

public class RGraphController {
	protected RGraphView rGraphView;
	protected RGraphModel rGraphModel;
	protected FileSystemModel fileSystemModel;
	protected PetriNetModel petriNetModel;
	
	public RGraphController(
		RGraphView rGraphView,
		RGraphModel rGraphModel,
		FileSystemModel fileSystemModel,
		PetriNetModel petriNetModel) {
		this.rGraphView = rGraphView;
		this.rGraphModel = rGraphModel;
		this.fileSystemModel = fileSystemModel;
		this.petriNetModel = petriNetModel;
		
		
		fileSystemModel.addEventListener(new EventListener() {
			@Override
			public void event(Event eventType) {
				if (eventType == Event.FILESYSTEM_NEW_FILE_OPENED) {
					rGraphView.renderInitialRGraph(rGraphModel);
				}
			}
		});
		
		rGraphModel.addEventListener(new EventListener() {
			@Override
			public void event(Event eventType) {
				if (eventType == Event.RGRAPH_NEW_NODE_ADDED) {
					rGraphView.updateRGraph(rGraphModel);
				}
			}
		});
		
		petriNetModel.addEventListener(new EventListener() {
			@Override
			public void event(Event eventType) {
				if (eventType == Event.PETRINET_UPDATED_CURRENT_MARKING) {
					rGraphModel.syncCurrentMarkingWithPetriNet();
				}
				if (eventType == Event.PETRINET_CREATED_NEW_MARKING) {
					rGraphModel.appendNewMarkingToGraph();
				}
				/*
				if(eventType == Event.PETRINET_MARKING_RESET) {
					rGraphModel.reset();
					rGraphView.renderInitialRGraph(rGraphModel);
				}
				*/
			}
		});
	}
}
